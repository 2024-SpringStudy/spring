name: Discussion Webhook

on:
  discussion:
    types: [created, edited]  # 새 Discussion이 생성되거나 수정될 때 실행

jobs:
  notify_webhook:
    runs-on: ubuntu-latest

    steps:
      - name: Send Webhook on Discussion Creation or Edit
        run: |
          BODY=$(echo "${{ github.event.discussion.body }}" | sed ':a;N;$!ba;s/\n/ /g' | sed 's/"/\\"/g')

          JSON=$(printf '{
            "event": "%s",
            "discussion_number": "%s",
            "discussion_url": "%s",
            "title": "%s",
            "user": "%s",
            "created_at": "%s",
            "updated_at": "%s",
            "body": "%s"
          }' \
            "${{ github.event.action }}" \
            "${{ github.event.discussion.number }}" \
            "${{ github.event.discussion.html_url }}" \
            "${{ github.event.discussion.title }}" \
            "${{ github.event.discussion.user.login }}" \
            "${{ github.event.discussion.created_at }}" \
            "${{ github.event.discussion.updated_at }}" \
            "$BODY")

          curl -X POST "http://52.79.203.123:8080/api/github/webhook" \
               -H "Content-Type: application/json" \
               -d "$JSON"
